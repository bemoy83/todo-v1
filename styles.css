/* ===== CSS CUSTOM PROPERTIES ===== */
:root {
  /* Colors */
  --bg: #f1f3f5;
  --card: #ffffff;
  --text: #212529;
  --muted: #6c757d;
  --border: #e9ecef;
  --green: #2f9e44;
  --red: #e03131;
  --amber: #f59f00;
  
  /* Neumorphism colors */
  --neuro-bg: #f1f3f5;
  --neuro-shadow-dark: #d1d5db;
  --neuro-shadow-light: #ffffff;
  
  /* Neumorphism shadows */
  --neuro-raised: 
    6px 6px 12px var(--neuro-shadow-dark),
    -6px -6px 12px var(--neuro-shadow-light);
  --neuro-pressed: 
    inset 3px 3px 6px var(--neuro-shadow-dark),
    inset -3px -3px 6px var(--neuro-shadow-light);
  --neuro-subtle: 
    3px 3px 6px var(--neuro-shadow-dark),
    -3px -3px 6px var(--neuro-shadow-light);
  
  /* Spacing Scale */
  --space-xs: 4px;
  --space-sm: 8px;
  --space-md: 12px;
  --space-lg: 16px;
  --space-xl: 24px;
  --space-xxl: 32px;
  
  /* Border Radius Scale */
  --radius-xs: 6px;
  --radius-sm: 10px;
  --radius: 12px;
  --radius-lg: 14px;
  --radius-full: 999px;
  
  /* Size Scale */
  --size-xs: 32px;
  --size-sm: 40px;
  --size-md: 44px;
  --size-lg: 56px;
  --size-xl: 60px;
  
  /* Layout */
  --topbar-h: var(--size-lg);
  --app-max-width: 680px;
  --card-min-height: var(--size-xl);
  --subtask-min-height: var(--size-lg);
  
  /* Shadows */
  --shadow: 0 4px 10px rgba(0,0,0,.08);
  --shadow-strong: 0 10px 24px rgba(0, 0, 0, 0.481);
  --focus: 0 0 0 2px #00000010, 0 0 0 4px var(--muted);
  
  /* Timing */
  --timing-fast: 140ms;
  --timing-normal: 200ms;
  --timing-slow: 300ms;
  --easing: ease-out;
  
  /* Z-index scale */
  --z-base: 0;
  --z-dropdown: 1000;
  --z-sticky: 1100;
  --z-modal: 1200;
}

/* ===== BASE STYLES ===== */
* {
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
}

body {
  margin: 0;
  font-family: 
    system-ui,
    -apple-system, 
    BlinkMacSystemFont,
    "Segoe UI",
    "Roboto",
    "Oxygen",
    "Ubuntu",
    "Cantarell",
    "Helvetica Neue",
    Arial,
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
  
  /* ADD THESE LINES FOR BACKGROUND IMAGE */
  background-image: url('/todo-v1/assets/background.PNG');
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  background-attachment: fixed;
  
  /* Keep existing styles */
  background-color: #f1f3f5; /* Fallback color */
  color: var(--text);
  font-size: 16px;
  line-height: 1.3;
  font-weight: 400;
}

/* Better text rendering for inputs and buttons */
input, 
textarea, 
button {
  font-family: inherit;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Platform-specific font optimization for iOS */
@supports (-webkit-touch-callout: none) {
  body {
    font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
  }
}

/* ===== TYPOGRAPHY ===== */
.topbar-title, 
.task-title { 
  font-weight: 700;
  font-size: 17px;
  line-height: 1.3;
  letter-spacing: -0.01em;
}

.task-title { 
  flex: 1; 
}

.sub-text {
  font-size: 15px;
  line-height: 1.4;
  flex: 1; 
}

.sub-text.done { 
  text-decoration: line-through; 
  color: var(--muted); 
}

/* ===== ICONS ===== */
.action,
.add-btn,
.add-sub-btn,
.menu-btn,
.card-handle,
.sub-handle {
  font-family: inherit;
  font-weight: 600;
}

/* Icon content */
.action.complete::before { content: "✓"; }
.action.edit::before { content: "✎"; }
.action.delete::before { content: "⌫"; }
.add-btn::before,
.add-sub-btn::before { content: "+"; }
.menu-btn::before { content: "☰"; }
.card-handle::before,
.sub-handle::before { content: "⋮⋮"; }

/* Icon sizing and effects */
.action::before,
.add-btn::before,
.add-sub-btn::before,
.menu-btn::before {
  display: inline-block;
  font-style: normal;
  font-variant: normal;
  text-rendering: auto;
  line-height: 1;
  font-size: 18px;
  font-weight: 300;
}

.action:hover::before {
  transform: scale(1.1);
  transition: transform 150ms ease;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .action::before,
  .add-btn::before,
  .menu-btn::before {
    font-weight: 900;
  }
}

/* ===== LAYOUT ===== */
.app { 
  max-width: var(--app-max-width); 
  margin: 0 auto; 
  padding: calc(var(--topbar-h) + var(--space-xl)) var(--space-lg) 140px; 
  display: flex; 
  flex-direction: column; 
  gap: var(--space-lg); 
  position: relative; 
}

.topbar { 
  position: sticky; 
  top: 0; 
  z-index: var(--z-sticky); 
  display: flex; 
  align-items: center; 
  gap: var(--space-md); 
  height: var(--topbar-h); 
  padding: max(var(--space-sm), env(safe-area-inset-top)) var(--space-md) var(--space-sm); 
  background: rgba(255, 255, 255, 1); 
  backdrop-filter: saturate(180%) blur(10px); 
  border-bottom: 1px solid var(--muted); 
}
.task-card,
.subtask,
.card-row {
  background: var(--card);
  border-radius: var(--radius);
  border: 2px solid #000; /* bold outline */

  /* cartoon-style hard shadow */
  //box-shadow: 6px 6px 0 #333;

  font-weight: 600; /* stronger text weight for comic look */
}

/* ===== TASK CARDS ===== */
.task-card { 
  //background: var(--bg);
  //border: 2px solid #000; /* bold outline */
  //border-radius: var(--radius); 
  /* hard shadow for cell-shaded look */
  box-shadow: 6px 6px 0px rgba(51, 51, 51, 0.704);
  overflow: hidden; 
  transition: transform var(--timing-fast) var(--easing), 
              box-shadow var(--timing-fast) var(--easing); 
  will-change: transform; 
  /* optional: slightly thicker text for comic feel */
}

.task-card.armed { 
  transform: translateY(-2px);
  /* hard shadow for cell-shaded look */
  box-shadow: 6px 8px 2px rgba(51, 51, 51, 0.698);
}

.task-card.all-completed .task-title {
  text-decoration: line-through;
  color: var(--muted);
}

.task-card.all-completed .badge {
  background: var(--green);
}

.task-card.saving {
  opacity: 0.7;
  pointer-events: none;
}

.task-card.success {
  animation: successPulse var(--timing-slow) var(--easing);
}

/* Card row */
.card-row {
  display: flex; 
  gap: var(--space-md); 
  align-items: center; 
  padding: var(--space-lg); 
  min-height: var(--card-min-height); 
  will-change: transform;
  touch-action: pan-y;
  position: relative;
  //background: var(--card);
  transition: transform var(--timing-fast) ease-out, box-shadow var(--timing-fast) ease-out;
  border-radius: var(--radius-xs) var(--radius-xs) 0 0;
  //border: 1px solid var(--muted);
  z-index: 1;
}

/* ===== SUBTASKS ===== */
.subtask-list { 
  display: flex; 
  flex-direction: column; 
  gap: var(--space-md); 
  padding: var(--space-sm) var(--space-lg) var(--space-sm); 
  background: var(--bg);
  box-shadow: none;
  //border-top: 1px solid var(--muted);
  border-radius: 0 0 var(--radius-sm) var(--radius-sm); 
}

.subtask {
  display: flex; 
  gap: var(--space-md); 
  align-items: center;
  //background: var(--card); 
  //border: 1px solid var(--muted);
  //border-radius: var(--radius-sm);
  min-height: var(--subtask-min-height); 
  padding: var(--space-sm) var(--space-md);
  //box-shadow: var(--shadow);
  touch-action: pan-y;
  transition: transform var(--timing-fast) var(--easing), 
              box-shadow var(--timing-fast) var(--easing), 
              opacity var(--timing-fast) var(--easing);
  position: relative; 
  will-change: transform;
}

.subtask.armed { 
  transform: translateY(-1px);
  box-shadow: 2px 4px 2px rgba(51, 51, 51, 0.501);
}

/* ===== FORM ELEMENTS ===== */
.add-bar {
  position: fixed; 
  left: 0; 
  right: 0; 
  bottom: 0; 
  z-index: var(--z-dropdown);
  background: rgba(255,255,255,.92); 
  backdrop-filter: saturate(180%) blur(10px);
  border-top: 1px solid var(--muted);
  padding: var(--space-md) var(--space-lg) calc(var(--space-md) + env(safe-area-inset-bottom));
  display: flex; 
  justify-content: center;
}

.add-inner { 
  width: 100%; 
  max-width: var(--app-max-width); 
  display: flex; 
  gap: var(--space-sm); 
}

/* Input fields */
.add-input,
.add-sub-input {
  flex: 1;
  min-height: var(--size-xs);
  background: var(--neuro-bg);
  border-radius: var(--radius-full);
  border: 2px solid #000; /* bold outline */
  padding: var(--space-sm) var(--space-md); 
  font-size: 15px;
  box-shadow: none);
  transition: box-shadow var(--timing-fast) ease;
}

.add-input:focus,
.add-sub-input:focus {
  outline: none;
  box-shadow: 
    inset 2px 2px 4px var(--neuro-shadow-dark),
    /*inset -2px -2px 4px var(--neuro-shadow-light),*/
    0 0 0 2px rgba(67, 67, 67, 1);
}

/* Inline add-subtask form */
.add-subtask-row { 
  display: flex; 
  gap: var(--space-sm); 
  align-items: center; 
}

/* ===== BUTTONS ===== */
.add-btn,
.menu-btn,
.add-sub-btn {
  background: var(--muted);
  border: 2px solid #000; /* bold outline */
  border-radius: var(--radius-full);
  color: white;
  box-shadow: none;
  transition: box-shadow var(--timing-fast) ease, transform var(--timing-fast) ease;
}

.add-btn,
.menu-btn { 
  min-height: var(--size-md); 
  min-width: var(--size-md); 
}

.add-sub-btn { 
  min-height: var(--size-xs); 
  min-width: var(--size-xs); 
}

.add-btn:active,
.menu-btn:active,
.add-sub-btn:active {
  transform: none;
  box-shadow: none;
}

/* ===== HANDLES ===== */
.card-handle,
.sub-handle { 
  flex: 0 0 auto; 
  display: flex; 
  align-items: center; 
  justify-content: center; 
  min-width: var(--space-xl); 
  min-height: var(--size-md);
  border-radius: var(--radius); 
  border: none; 
  background: none; 
  color: var(--muted); 
  font-weight: 800; 
  cursor: grab; 
  touch-action: none; 
  -webkit-user-drag: none; 
}

.card-handle:active,
.sub-handle:active { 
  cursor: grabbing; 
}

/* ===== BADGE ===== */
.badge {
  font-weight: 600;
  font-size: 13px;
  font-variant-numeric: tabular-nums;
  letter-spacing: 0.02em;
  color: white;
  background: var(--red);
  border: 2px solid #000; /* bold outline */
  min-width: var(--space-xl); 
  text-align: center; 
  padding: var(--space-sm) var(--space-md); 
  border-radius: var(--radius-full);
  box-shadow: none;
}

/* ===== MENU ===== */
.menu {
  position: fixed; 
  top: calc(env(safe-area-inset-top) + var(--space-md) + var(--topbar-h)); 
  left: 50%; 
  display: flex; 
  flex-direction: column;
  gap: var(--space-sm); 
  padding: var(--space-sm);
  background: var(--neuro-bg);
  z-index: var(--z-modal);
  opacity: 0; 
  border: none;
  border-radius: var(--radius-lg);
  transform: translateX(-50%) translateY(-6px) scale(.98);
  pointer-events: none; 
  width: min(260px, calc(100% - 24px));
  transition: opacity var(--timing-fast) ease, transform var(--timing-fast) ease;
  box-shadow: 
    10px 10px 20px var(--neuro-shadow-dark),
    -10px -10px 20px var(--neuro-shadow-light);
}

.menu.open { 
  opacity: 1; 
  transform: translateX(-50%) translateY(0) scale(1);
  pointer-events: auto; 
}

.menu-item {
  align-items: center;
  background: var(--card);
  border: none;
  border-radius: var(--radius-sm);
  padding: var(--space-md) var(--space-lg);
  transition: background var(--timing-fast) ease, 
              box-shadow var(--timing-fast) ease;
  margin: 2px;
  font-weight: 700; 
  font-size: var(--space-lg);
  box-shadow: var(--neuro-raised);
}

.menu-item:active {
  box-shadow: 
    inset 4px 4px 8px var(--neuro-shadow-dark),
    inset -4px -4px 8px var(--neuro-shadow-light);
}

.menu-item.danger { 
  color: var(--red); 
  background: #fff5f5; 
  border-color: #ffe3e3; 
}

/* ===== SWIPE GESTURES ===== */
.swipe-wrap, 
.card-swipe-wrap {
  position: relative;
  border-radius: var(--radius-sm);
}

.card-swipe-wrap {
  overflow: hidden;
}

.swipe-wrap.swiping .subtask, 
.card-swipe-wrap.swiping .card-row { 
  touch-action: none; 
  transition: none;
}

.lock-scroll {
  overflow: hidden; 
  overscroll-behavior: none; 
}

/* Swipe actions */
.swipe-actions,
.card-swipe-actions { 
  position: absolute; 
  top: 0;
  left: 0;
  right: 0;
  display: grid; 
  grid-template-columns: 1fr 1fr; 
  pointer-events: none;
  background: #f8f9fa;
  overflow: hidden;
  z-index: 0;
}

.swipe-actions {
  height: var(--subtask-row-height, var(--size-lg));
  border-radius: var(--radius-sm);
}

.card-swipe-actions {
  height: var(--card-row-height, var(--size-xl));
  border-radius: var(--radius) var(--radius) 0 0;
}

/* Action zones */
.swipe-actions .zone,
.card-swipe-actions .zone { 
  display: flex; 
  align-items: center; 
  padding: 0 var(--space-lg); 
  gap: var(--space-md); 
  --reveal: 0; 
  --pulse: 1;
  min-height: inherit;
  transition: background-color var(--timing-normal) ease;
  background: var(--neuro-bg);
}

.swipe-actions .zone.left,
.card-swipe-actions .zone.left { 
  justify-content: flex-start;
}

.swipe-actions .zone.right,
.card-swipe-actions .zone.right { 
  justify-content: flex-end;
}

/* Action buttons */
.swipe-actions .action,
.card-swipe-actions .action {
  pointer-events: auto; 
  width: var(--size-sm); 
  height: var(--size-sm);
  border-radius: 50%;
  flex-shrink: 0; 
  font-size: 20px;
  color: white;
  display: inline-flex; 
  align-items: center; 
  justify-content: center;
  background: var(--bg);
  box-shadow: none;
  border: 2px solid #000; /* bold outline */
  opacity: var(--reveal);
  transform: scale(calc((0.2 + var(--reveal) * 0.8) * var(--pulse)));
  transition: transform var(--timing-fast) ease, 
              opacity var(--timing-fast) ease,
              box-shadow var(--timing-fast) ease;
}

.swipe-actions .action:active,
.card-swipe-actions .action:active {
  box-shadow: var(--neuro-pressed);
  transform: scale(0.95);
}

/* Action button variants */
.swipe-actions .action.complete,
.card-swipe-actions .action.complete { 
  --bg: var(--green); 
  --fg: white; 
}

.swipe-actions .action.edit,
.card-swipe-actions .action.edit { 
  --bg: var(--muted); 
  --fg: white; 
}

.swipe-actions .action.delete,
.card-swipe-actions .action.delete { 
  --bg: var(--red); 
  --fg: white; 
}

/* Hold feedback */
.swipe-wrap.held .swipe-actions .action,
.card-swipe-wrap.held .card-swipe-actions .action {
  transform: scale(calc((0.8 + var(--reveal) * 0.3) * var(--pulse) * 1.05));
}

/* ===== UTILITY STYLES ===== */
.drag-layer { 
  position: absolute; 
  inset: 0; 
  pointer-events: none; 
  z-index: var(--radius-full); 
}

.placeholder { 
  background: none;
  box-shadow: none;
  border: 2px dashed  white;
  border-radius: var(--radius);
}

.drag-ghost {
  position: absolute; 
  top: 0;
  transform: translate3d(0,0,0);
  width: var(--ghost-w, auto);
  height: var(--ghost-h, auto);
  border-radius: var(--radius-sm);
  opacity: 0.70;
  box-shadow: none
  visibility: hidden;
}

.empty {
  display: flex; 
  flex-direction: column; 
  align-items: center; 
  gap: var(--space-sm); 
  padding: var(--space-xxl); 
  color: var(--muted); 
  border: 2px dashed var(--border); 
  border-radius: var(--radius);
  background: var(--card);
}

/* ===== ANIMATIONS ===== */
@keyframes successPulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.02); }
  100% { transform: scale(1); }
}

/* ===== ACCESSIBILITY ===== */
/* Reduced Motion Support */
@media (prefers-reduced-motion: reduce) {
  .task-card, 
  .task-card.armed, 
  .subtask, 
  .subtask.armed,
  .card-row { 
    transition: none !important; 
    transform: none !important; 
  }
  
  .swipe-actions .action,
  .card-swipe-actions .action { 
    transition: opacity 60ms linear; 
  }
}

/* ===== iOS OPTIMIZATIONS ===== */
@supports (-webkit-touch-callout: none) {
  .app {
    min-height: calc(var(--vh, 1vh) * 100);
    padding-top: calc(var(--topbar-h, 56px) + var(--safe-top, 0px));
    padding-bottom: calc(140px + var(--safe-bottom, 0px));
  }
  
  .topbar {
    padding-top: max(8px, var(--safe-top, env(safe-area-inset-top)));
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: saturate(180%) blur(20px);
    -webkit-backdrop-filter: saturate(180%) blur(20px);
  }
  
  .add-bar {
    padding-bottom: calc(16px + var(--safe-bottom, env(safe-area-inset-bottom)));
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: saturate(180%) blur(20px);
    -webkit-backdrop-filter: saturate(180%) blur(20px);
  }
  
  /* Prevent zoom on inputs */
  input, textarea {
    font-size: max(16px, 1em);
    min-height: 44px;
    transition: font-size 0.1s ease;
  }
  
  /* Hardware acceleration */
  .task-card, .subtask {
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
  }
  
  /* Handle notch and Dynamic Island */
  .has-notch .topbar {
    padding-top: max(20px, var(--safe-top, env(safe-area-inset-top)));
  }
  
  .has-dynamic-island .topbar {
    padding-top: max(24px, var(--safe-top, env(safe-area-inset-top)));
  }
  
  /* PWA styles */
  .standalone-app .topbar {
    padding-top: var(--safe-top, env(safe-area-inset-top));
  }
  
  /* Smooth scrolling */
  .app, .subtask-list {
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
  }
  
  /* Better focus states */
  input:focus, textarea:focus, button:focus {
    outline: 2px solid rgba(59, 130, 246, 0.6);
    outline-offset: 2px;
  }
}

/* iPhone PWA standalone mode */
@media (display-mode: standalone) {
  body {
    overscroll-behavior-y: contain; /* Prevent pull-to-refresh */
  }
  
  .topbar {
    padding-top: max(20px, env(safe-area-inset-top));
    background: rgba(255,255,255,.95);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
  }
  
  .app {
    padding-top: calc(var(--topbar-h) + var(--space-xl) + env(safe-area-inset-top));
    padding-bottom: calc(140px + env(safe-area-inset-bottom));
    min-height: -webkit-fill-available;
  }
  
  .add-bar {
    padding-bottom: calc(var(--space-md) + env(safe-area-inset-bottom));
  }
}